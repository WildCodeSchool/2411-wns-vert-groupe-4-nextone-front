import { Outlet, useLocation } from "react-router";
import DashboardMenuTooltip from "./DashboardMenuTooltip";
import { FaTicketSimple } from "react-icons/fa6";
import { MdRoomService } from "react-icons/md";
import { IoPerson } from "react-icons/io5";
import { LuLayoutDashboard } from "react-icons/lu";
import { useAuth } from "@/context/AuthContext";

export type DashboardMenuItem = {
  name: string;
  path: string;
  icon: React.ReactNode;
};

export default function DashboardLayout() {
  const { user, logout } = useAuth();

  const location = useLocation();

  const dashboardMenu: DashboardMenuItem[] = [
    {
      name: "Accueil",
      path: "/dashboard",
      icon: <LuLayoutDashboard size="1.2rem" />,
    },
    {
      name: "Services",
      path: "/dashboard/services",
      icon: <MdRoomService size="1.4rem" />,
    },
    {
      name: "Tickets",
      path: "/dashboard/tickets",
      icon: <FaTicketSimple size="1.2rem" />,
    },
  ];

  const dashboardUserSettingsMenuItem: DashboardMenuItem = {
    name: `${user?.firstName} ${user?.lastName}`,
    path: "/dashboard/settings",
    icon: <IoPerson size="1.2rem" />,
  };

  const isActive = (path: string) => {
    if (path === "/dashboard") {
      return location.pathname === path;
    }

    return location.pathname.startsWith(path);
  };

  return (
    <div className="flex flex-row h-screen w-screen bg-background">
      <div className="w-20 p-5 flex flex-col items-center justify-between bg-popover">
        <div className="flex items-center justify-center w-full aspect-square rounded-md bg-primary text-white">
          <svg
            width="1rem"
            height="1rem"
            viewBox="0 0 108 138"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M58.308 88.6167C58.4743 88.5947 58.6407 88.5727 59.0482 88.5505C59.5618 88.3906 59.8341 88.2309 60.1065 88.0712C60.2483 88.0478 60.3902 88.0244 60.7492 88.0164C61.9669 87.6814 62.9675 87.331 63.9681 86.9806C64.1339 86.9506 64.2997 86.9205 64.7019 86.8877C65.2089 86.7298 65.4794 86.5747 65.7499 86.4195C66.0117 86.3774 66.2734 86.3353 66.7988 86.2794C67.3804 86.1023 67.6982 85.939 68.016 85.7757C68.1823 85.7558 68.3487 85.7359 68.7544 85.712C69.265 85.5489 69.5361 85.3897 69.8072 85.2305C69.951 85.2133 70.0948 85.1961 70.4563 85.1986C71.6743 84.8574 72.6746 84.4966 73.675 84.1357C73.8411 84.1071 74.0071 84.0785 74.4084 84.0482C74.9166 83.8978 75.1896 83.7491 75.4626 83.6004C75.7212 83.5521 75.9797 83.5038 76.5247 83.4306C79.2199 82.689 81.6288 81.9724 84.0377 81.2557C83.9839 81.0703 83.9302 80.8849 83.8764 80.6995C81.1572 81.2278 78.4381 81.7562 75.7189 82.2845C75.3042 82.3116 74.8894 82.3387 74.1648 82.3469C73.0813 82.518 72.3078 82.7079 71.5343 82.8977C71.2636 82.9128 70.993 82.9278 70.4705 82.9129C69.354 83.078 68.4893 83.2731 67.6246 83.4681C67.3324 83.4791 67.0403 83.4901 66.4421 83.4928C65.4245 83.6496 64.7129 83.8147 64.0013 83.9797C63.7125 84.0034 63.4238 84.0272 62.8464 84.0252C61.909 84.1712 61.2602 84.3429 60.6114 84.5146C59.9668 84.5686 59.3221 84.6225 58.3652 84.671C57.4697 84.8214 56.8865 84.9772 56.3033 85.133C55.8884 85.1566 55.4736 85.1802 54.7573 85.1866C53.8028 85.3433 53.1498 85.5173 52.4967 85.6913C52.2322 85.709 51.9677 85.7267 51.4466 85.7174C50.1955 85.8955 49.201 86.1006 48.2065 86.3057C47.9157 86.3194 47.6249 86.333 47.0342 86.3362C45.9524 86.5067 45.1706 86.6876 44.3887 86.8685C43.8711 86.929 43.3535 86.9895 42.6223 87.0097C42.1316 87.0831 41.8545 87.1966 41.5774 87.3102C40.9337 87.3683 40.2899 87.4264 39.3359 87.4847C38.4473 87.6386 37.8692 87.7923 37.291 87.946C36.9957 87.9615 36.7005 87.9769 36.0725 87.9854C30.3541 87.9758 24.9684 87.9548 19.5829 87.9759C14.5381 87.9956 9.49338 88.0598 4.44862 88.1045C4.27986 88.0667 4.1111 88.0288 3.72124 87.8915C3.01249 87.591 2.52486 87.3901 2.03722 87.1892C2.03722 87.1892 1.92818 87.067 1.81921 86.9136C1.47034 86.539 1.23045 86.3178 0.990556 86.0965C0.833861 85.8232 0.677168 85.5498 0.475575 85.0428C0.289257 84.4884 0.14784 84.1675 0.0064198 83.8467C0.00787059 75.0858 0.00932142 66.325 0.081718 57.2677C0.238972 56.635 0.325278 56.2986 0.411583 55.9622C0.564698 55.6842 0.717813 55.4062 1.03284 54.9702C1.39029 54.5532 1.58582 54.2942 1.78135 54.0352C1.96126 53.9233 2.14118 53.8115 2.57627 53.6265C3.81173 53.3895 4.79033 53.0971 5.7726 53.0842C9.86014 53.0306 13.9489 53.0768 18.037 53.0573C23.9308 53.0291 29.8245 52.9756 35.7183 52.933C36.137 52.9851 36.5557 53.0373 37.2576 53.1726C38.2684 53.3412 38.996 53.4266 39.7235 53.5119C40.3547 53.5819 40.9858 53.6518 41.8705 53.8345C42.6875 53.9905 43.251 54.0337 43.8146 54.0768C44.1081 54.128 44.4016 54.1791 44.9599 54.3273C45.961 54.4961 46.6972 54.568 47.4335 54.6399C47.6046 54.6704 47.7758 54.701 48.201 54.7979C49.4514 54.9796 50.4477 55.095 51.4441 55.2103C51.8208 55.2594 52.1975 55.3084 52.8181 55.4587C53.7523 55.6352 54.4427 55.7105 55.1331 55.7858C55.4256 55.8273 55.7181 55.8688 56.2869 55.989C57.2899 56.1524 58.0167 56.2371 58.7434 56.3218C58.9175 56.3471 59.0916 56.3723 59.5267 56.4621C60.802 56.6478 61.8162 56.7689 62.8304 56.89C63.2504 56.9518 63.6703 57.0137 64.3584 57.1746C65.2359 57.3288 65.8452 57.3841 66.4544 57.4394C66.7464 57.4827 67.0383 57.5261 67.5913 57.6425C68.7211 57.8227 69.59 57.9299 70.4588 58.037C70.8405 58.0838 71.2222 58.1306 71.8516 58.2675C72.7842 58.4287 73.4691 58.4998 74.1541 58.571C74.4453 58.6168 74.7366 58.6625 75.3061 58.7946C76.4242 59.0216 77.2602 59.2426 78.1049 59.283C79.1946 59.3352 80.2912 59.243 81.3719 59.1854C81.359 59.1577 81.458 59.1758 81.458 59.1758C81.458 59.1758 81.3775 59.205 81.2333 59.2498C79.5559 58.7549 78.0226 58.2153 76.4893 57.6756C76.2335 57.614 75.9777 57.5523 75.5031 57.3719C73.6723 56.8188 72.0602 56.3845 70.4481 55.9502C70.3119 55.9122 70.1757 55.8741 69.846 55.7193C68.6981 55.3456 67.7436 55.0886 66.7892 54.8316C66.5347 54.7722 66.2802 54.7129 65.809 54.5314C63.9736 53.9761 62.355 53.543 60.7363 53.1099C60.6032 53.0719 60.4701 53.034 60.144 52.8807C58.9958 52.5061 58.0407 52.2468 57.0856 51.9874C56.8335 51.9291 56.5815 51.8709 56.1341 51.6981C55.6303 51.5375 55.322 51.4913 55.0137 51.4451C54.8466 51.3892 54.6796 51.3333 54.2885 51.1628C53.0511 50.7885 52.0377 50.5287 51.0244 50.2689C50.8952 50.2304 50.7659 50.1919 50.4464 50.0359C49.297 49.6637 48.3377 49.4091 47.3785 49.1545C33.3055 45.0167 19.2259 40.9008 5.16421 36.7252C1.846 35.7399 0.0325853 33.2376 0.0208127 29.8364C-0.00712728 21.7633 -0.00596983 13.69 0.0184978 5.61684C0.0293382 2.04002 2.09241 0.0209828 5.70909 0.0129468C13.7994 -0.00502854 21.8898 -0.00209011 29.9801 0.00847146C33.6301 0.0132365 36.7854 1.28271 39.5649 3.65313C58.6557 19.9346 77.768 36.191 96.8689 52.4608C99.1732 54.4236 101.424 56.4503 103.75 58.3868C105.386 59.749 106.019 61.449 105.998 63.5348C105.95 68.1764 105.945 72.8193 105.999 77.4608C106.026 79.7056 105.236 81.4304 103.504 82.8996C90.826 93.6548 78.1836 104.452 65.5371 115.244C60.3661 119.657 55.2127 124.09 49.8127 128.609C49.2323 129.074 48.8905 129.445 48.5488 129.816C48.2235 130.055 47.8981 130.294 47.371 130.649C46.6759 131.247 46.1826 131.73 45.6893 132.214C45.2405 132.59 44.7917 132.966 44.1287 133.447C43.4224 134.044 42.9304 134.534 42.4384 135.025C42.1265 135.272 41.8146 135.519 41.2922 135.873C40.7318 136.34 40.3818 136.701 40.0319 137.063C39.3358 137.601 38.6399 138.14 37.6994 138.752C36.9445 139.156 36.4341 139.485 35.9237 139.815C35.7807 139.855 35.6378 139.895 35.2707 139.963C34.8479 140.127 34.6493 140.263 34.4507 140.398C34.2842 140.422 34.1176 140.446 33.6889 140.467C32.9062 140.643 32.3857 140.821 31.8652 140.999C22.7836 141.002 13.702 141.005 4.35588 140.899C3.67221 140.689 3.25305 140.586 2.83388 140.484C2.35274 140.108 1.8716 139.732 1.27449 139.135C0.777891 138.186 0.397267 137.458 0.0166396 136.729C0.0211182 127.972 0.0255999 119.214 0.116785 110.159C0.706929 108.732 1.21037 107.602 1.71381 106.472C1.80811 106.392 1.89724 106.305 2.16222 106.12C2.55033 105.782 2.75741 105.539 2.96449 105.296C3.51533 105.006 4.06616 104.716 4.87345 104.403C5.52293 104.198 5.91597 104.017 6.309 103.836C6.4483 103.816 6.58759 103.796 6.91151 103.798C7.36312 103.67 7.63011 103.522 7.89711 103.373C8.15437 103.32 8.41164 103.267 8.95768 103.196C11.5008 102.45 13.7551 101.721 16.0095 100.991C16.1514 100.973 16.2933 100.955 16.6193 100.958C17.0652 100.826 17.327 100.675 17.5889 100.523C17.85 100.475 18.1112 100.427 18.6532 100.367C19.8424 100.02 20.7507 99.6852 21.6591 99.3499C21.8044 99.3284 21.9498 99.3069 22.314 99.2973C23.5928 98.9248 24.6528 98.5405 25.7128 98.1561C25.8567 98.1376 26.0006 98.119 26.3622 98.1157C28.1726 97.5902 29.7654 97.0493 31.3582 96.5085C31.6185 96.463 31.8787 96.4176 32.4228 96.3449C34.1306 95.8235 35.5544 95.3295 36.9782 94.8354C37.2467 94.7981 37.5152 94.7607 38.0376 94.7128C38.4919 94.5684 38.6922 94.4346 38.8925 94.3008C39.0579 94.2702 39.2233 94.2396 39.6398 94.2111C40.2796 94.0316 40.6683 93.8499 41.0571 93.6683C41.3179 93.6214 41.5788 93.5745 42.0828 93.5046C42.5312 93.3608 42.7365 93.24 42.9418 93.1192C43.1091 93.0941 43.2765 93.0691 43.7132 93.0346C44.7701 92.7129 45.5575 92.4007 46.345 92.0885C46.7211 92.0221 47.0971 91.9557 47.7335 91.8728C48.1961 91.725 48.3984 91.5938 48.6008 91.4625C48.7672 91.4386 48.9335 91.4146 49.3764 91.3884C52.5379 90.4631 55.4229 89.5399 58.308 88.6167Z"
              fill="#B5E303"
            />
          </svg>
        </div>
        <ul className="w-full flex flex-col items-center justify-center gap-4">
          {dashboardMenu.map((item) => (
            <li key={item.name} className="w-full">
              <DashboardMenuTooltip
                item={item}
                isActive={isActive(item.path)}
              />
            </li>
          ))}
        </ul>
        <DashboardMenuTooltip
          item={dashboardUserSettingsMenuItem}
          user={user}
          logout={logout}
        />
      </div>
      <div className="flex-1 p-8 overflow-y-auto flex flex-col justify-start items-start">
        <Outlet />
      </div>
    </div>
  );
}
